machine:
  services:
    - docker
    - couchdb

dependencies:
  override:
  pre:
  - mvn clean install
  post:
  - docker build -t manlulu/circle .


deployment:
  production:
    branch: master
    commands:

      - docker login -e $kim.flaethe@accenture.com -u manlulu -p $DOCKER_PASS
      - docker push manlulu/circle
      - ssh manlulu@littavdenjaffal.cloudapp.net "sudo docker pull manlulu/circle"
      - ssh manlulu@littavdenjaffal.cloudapp.net "sudo docker pull manlulu/couchdb"
      - ssh manlulu@littavdenjaffal.cloudapp.net "sudo docker rm -f app"
      - ssh manlulu@littavdenjaffal.cloudapp.net "sudo docker rm -f db"
      - ssh manlulu@littavdenjaffal.cloudapp.net "sudo docker run -d -p 80:8080 -p 5984:5984 --name app manlulu/circle"
      - ssh manlulu@littavdenjaffal.cloudapp.net "sudo docker run -d -p 5984:5984 --name db --net='container:app' manlulu/couchdb"